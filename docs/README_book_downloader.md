# 書籍下載器使用說明

基於現有的 ctext.org 爬蟲代碼，新增了一個便捷的書籍下載器，可以根據書名直接下載書籍內容。

## 功能特點

- 🔍 **智能搜索**: 支持精確匹配和模糊匹配書名
- 🔄 **繁體轉簡體**: 自動將繁體書名轉換為簡體進行搜索
- 📚 **自動下載**: 一鍵下載完整書籍內容
- 📁 **自動整理**: 自動創建目錄並保存為文本文件
- 📋 **豐富信息**: 包含書籍元數據（作者、朝代、創作日期等）
- 🎯 **用戶友好**: 交互式選擇，支持命令行參數

## 使用方法

### 1. 基本下載

```bash
# 下載指定書籍
python book_downloader.py "論語"

# 指定輸出目錄
python book_downloader.py "論語" --output my_books
```

### 2. 查看可用書籍

```bash
# 查看前20本書
python book_downloader.py --list

# 查看所有書籍
python book_downloader.py --list-all

# 只顯示不需要認證的書籍
python book_downloader.py --list --check-auth
```

### 3. 調試和故障排除

```bash
# 調試特定書籍
python debug_tools.py "全唐詩"

# 查看常見問題和解決方案
python debug_tools.py --issues
```

### 4. 獲取幫助

```bash
python book_downloader.py --help
```

## 使用示例

### 示例1: 下載《論語》

```bash
$ python book_downloader.py "論語"
正在搜索書籍: 論語
找到精確匹配: 論語 (ctp:analects)
正在獲取網頁內容: https://ctext.org/analects/zh
正在下載書籍內容...
書籍已成功下載到: books/論語.txt
文件大小: 15420 字符
下載完成！
```

### 示例2: 繁體書名搜索

```bash
$ python book_downloader.py "論語"
正在搜索書籍: 論語
嘗試繁體轉簡體搜索: 论语
找到精確匹配 (轉換後): 论语 (ctp:analects)
正在下載書籍內容...
找到 20 個章節，正在獲取各章節內容...
書籍已成功下載到: books/论语.txt
文件大小: 22105 字符
下載完成！
```

### 示例3: 模糊搜索

```bash
$ python book_downloader.py "詩"
正在搜索書籍: 詩
找到 3 個模糊匹配:
  1. 詩經 (ctp:book-of-poetry)
  2. 詩品 (ctp:shipin)
  3. 詩話總龜 (ctp:shihuazonggui)
請選擇書籍 (1-3): 1
正在獲取網頁內容: https://ctext.org/book-of-poetry/zh
正在下載書籍內容...
書籍已成功下載到: books/詩經.txt
文件大小: 45678 字符
下載完成！
```

### 示例4: 查看可用書籍

```bash
$ python book_downloader.py --list
正在獲取書籍列表...
總共有 1234 本書可用
顯示前 20 本:
--------------------------------------------------
  1. 論語
  2. 孟子
  3. 大學
  4. 中庸
  5. 詩經
  6. 尚書
  7. 禮記
  8. 周易
  9. 春秋
 10. 左傳
 11. 公羊傳
 12. 穀梁傳
 13. 孝經
 14. 爾雅
 15. 說文解字
 16. 史記
 17. 漢書
 18. 後漢書
 19. 三國志
 20. 晉書
... 還有 1214 本書
使用 --list-all 查看所有書籍
```

## 輸出文件格式

下載的書籍會保存為 UTF-8 編碼的文本文件，包含以下信息：

```
書名: 論語
URN: ctp:analects
作者: 孔子
朝代: 春秋 - 戰國
創作日期: 前479 - 前400
下載時間: 2024-01-15 14:30:25
==================================================

學而第一

子曰：「學而時習之，不亦說乎？有朋自遠方來，不亦樂乎？人不知而不慍，不亦君子乎？」

有子曰：「其為人也孝弟，而好犯上者，鮮矣；不好犯上，而好作亂者，未之有也。君子務本，本立而道生。孝弟也者，其為仁之本與！」

...

[完整的書籍內容]
```

## 命令行參數

| 參數 | 簡寫 | 說明 | 示例 |
|------|------|------|------|
| `book_name` | - | 要下載的書籍名稱 | `"論語"` |
| `--output` | `-o` | 輸出目錄 | `--output my_books` |
| `--list` | `-l` | 列出前20本可用書籍 | `--list` |
| `--list-all` | - | 列出所有可用書籍 | `--list-all` |
| `--check-auth` | - | 檢查認證要求並只顯示可下載的書籍 | `--list --check-auth` |
| `--help` | `-h` | 顯示幫助信息 | `--help` |

## 注意事項

1. **網絡連接**: 需要穩定的網絡連接來訪問 ctext.org
2. **請求頻率**: 程序會自動控制請求頻率，避免對服務器造成壓力
3. **文件編碼**: 所有文件都使用 UTF-8 編碼保存
4. **文件名**: 特殊字符會被自動處理，確保文件名兼容性
5. **內容清理**: 程序會自動清理網頁中的導航、廣告等無關內容
6. **繁體轉簡體**: 使用 opencc 包進行轉換，如果未安裝會使用備用方案

## 錯誤處理

- 如果找不到指定書籍，程序會提示並退出
- 如果網絡連接失敗，會顯示錯誤信息
- 如果文件保存失敗，會顯示具體錯誤原因
- 如果書籍需要認證，會顯示認證要求和解決方案
- 使用 `debug_tools.py` 可以詳細診斷問題

## 與現有代碼的關係

這個下載器基於現有的代碼：
- 使用了 `get_book_list.py` 中的 API 調用方式
- 借鑒了 `crawler.py` 中的文本提取邏輯
- 保持了與 `test_api.py` 相同的 API 測試方法
- 新增了繁體轉簡體功能，使用 `opencc` 包進行轉換

## 依賴包

```bash
# 安裝繁體轉簡體轉換包（可選，有備用方案）
pip install opencc-python-reimplemented
```

## 實際測試結果

已成功測試下載的書籍：
- ✅ **論語** (22,105 字符) - 包含20個章節
- ✅ **詩經** (39,615 字符) - 包含4個主要部分，多層級章節結構
- ✅ **道德經** (6,524 字符) - 直接文本內容
- ✅ **孟子** (45,622 字符) - 包含14個章節

繁體轉簡體測試：
- ✅ **論語** (繁體) -> **论语** (簡體) - 成功下載
- ✅ **詩經** (繁體) -> **诗经** (簡體) - 成功下載
- ✅ **道德經** (繁體) -> **道德经** (簡體) - 成功下載
- ✅ **史記** (繁體) -> **史记** (簡體) - 找到書籍（需要認證）
- ✅ **全唐詩** (繁體) -> **全唐诗** (簡體) - 找到書籍（需要認證）

## 文件結構

```
ctext.org_-crawler/
├── book_downloader.py              # 主要下載器
├── debug_tools.py                  # 調試工具
├── example_usage.py                # 使用示例
├── test_traditional_conversion.py  # 繁體轉簡體測試
├── install_dependencies.py         # 依賴包安裝腳本
├── test_api.py                     # API測試
├── crawler.py                      # 原始爬蟲
├── get_book_list.py                # 書籍列表獲取
├── README_book_downloader.md       # 使用說明
├── test_books/                     # 測試下載目錄
│   ├── 论语.txt
│   ├── 诗经.txt
│   └── 道德经.txt
├── example_books/                  # 示例下載目錄
│   ├── 论语.txt
│   └── 诗经.txt
└── traditional_test_books/         # 繁體測試下載目錄
    ├── 论语.txt
    ├── 孟子.txt
    ├── 诗经.txt
    └── 道德经.txt
```

## 擴展功能

可以根據需要添加以下功能：
- 批量下載多本書籍
- 支持不同格式輸出（HTML、PDF等）
- 添加進度條顯示
- 支持斷點續傳
- 添加書籍分類功能 